{
  "hash": "bea10d87e1e4d5179009fb66e4ad570c",
  "result": {
    "markdown": "---\ntitle: UC Reserve Fire Data\ndescription: --2020 Fire Data Visualization\nauthor: RJ Cody Markelz\ncategories: [GIS, maps, data, fire, wildfire, climate, research, geospatial, fire runner]\ndate: 2022-07-15\nimage: /images/reserve-hennessey-fire.png\n---\n\n\n\n\nA short post overlaying a few different GIS layers on one another for a project we are working on. The databases used are large so I just show the code here with one final image instead of including them in the website repository. I needed to subset the fire perimeters from the Cal Fire database and overlap them with the UC Reserve perimeters. I also needed to in-file some GPS coordinates of post fire sampling sites. I share the code below, but not the data as this project is still in progress. However, the raw data is available:\n\n[Cal Fire Data](https://frap.fire.ca.gov/mapping/gis-data/)\n\n[UC Reserve Perimeter Data](https://ucnrs.org/gis-database/)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tidyverse)\nlibrary(rgdal)\n\nsetwd(\"~/DATA/data/calfire.nosync/\")\nfire <- st_read(\"fire20_1.gdb\")\nreserves <- st_read(\"UC_NRS.gdb\")\n\n# subset fire data for 2020\nfire2020 <- fire[fire$YEAR_ == \"2020\",]\nplot(fire2020$Shape)\nplot(reserves$Shape)\nstr(fire2020)\nstr(reserves)\n```\n:::\n\n\n\nIntersect the reserves and 2020 fires.\n\n::: {.cell}\n\n```{.r .cell-code}\noverlaps2020 <-  lengths(st_intersects(fire2020, reserves)) > 0\nfire_reserves2020 <- fire2020[overlaps2020,]\nplot(fire_reserves2020$Shape, col=\"orange\")\nplot(reserves$Shape, col=\"blue\", add = TRUE)\n```\n:::\n\n\nTake a look at the names of the fires that overlap and then specifically subset them for later processing.\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_reserves2020$FIRE_NAME\nriver_fire <- subset(fire2020, FIRE_NAME == \"RIVER\")\nscu_complex_fire <- subset(fire2020, FIRE_NAME == \"SCU COMPLEX\")\nhennessey_fire <- subset(fire2020, FIRE_NAME == \"HENNESSEY\")\ndolan_fire <- subset(fire2020, FIRE_NAME == \"DOLAN\")\nsnow_fire <- subset(fire2020, FIRE_NAME == \"SNOW\") # did not collect field data here\n```\n:::\n\n\nInfile the arthropod sampling locations and make a coordinates dataframe.\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"~/DATA/data/\")\narthro_data <- read_csv(\"Post-FireMonitoring_Arthropod_SamplingLocations.csv\")\narthro_coords <- data.frame(x = arthro_data$LONGITUDE, y = arthro_data$LATITUDE)\n```\n:::\n\n\nI converted the data frame to a spatial object with the appropriate map projection information. This then allowed me to convert Lat/Long coordinates to the same projection that the Cal Fire and UC Reserve System perimeters data are projected in (California Albers- EPSG:3310).\n\n::: {.cell}\n\n```{.r .cell-code}\n# make spatial dataframe with lat long coords using the RGDAL package functions\ncoordinates(arthro_coords) <- ~x+y\nproj4string(arthro_coords) <- CRS(\"+proj=longlat +datum=WGS84\")\nstr(arthro_coords)\n\narthro_3310 <- spTransform(df, CRS(\"+init=epsg:3310\"))\narthro_3310\nstr(arthro_3310)\n\n# double check with plot\nplot(reserves$Shape, col=\"blue\")\nplot(arthro_3310, , col = \"red\", add = TRUE)\n```\n:::\n\n\nConvert the object to and sf object for quick plotting. Calculate the overlays between the fire sampling site and the control sampling sites. Overlay the fire perimeter, the reserve perimeters, and the sampling sites. To make it more clear I chose the Hennessey Fire which burned across two reserve boundaries in 2020.\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert to sf package object\nfire_pts2 <- st_as_sf(arthro_3310)\nstr(fire_pts2)\n\n# overlay points and fire shapes\nfire_yes = lengths(st_intersects(fire_pts2, hennessey_fire)) > 0\nfire_yes\n\n# layer all the plots\nplot(hennessey_fire$Shape) # fire shape\nplot(reserves$Shape, col=\"orange\", add=TRUE) # local reserves shape\nplot(fire_pts2, pch=19, col=\"blue\", add=TRUE); # all samples\nplot(fire_pts2[fire_yes,], pch=19, col=\"red\", add=TRUE); # samples in fire\n```\n:::\n\nIt is over-plotted in this view, but this demonstrates the idea. The Hennessey fire perimeter is shown in black, reserves in orange, reserve sampling sites within the fire perimeter in red, and sampling sites within the reserve, but outside the fire perimeter in blue.\n\n<p align=\"Left\">\n  <img src=\"/images/reserve-hennessey-fire.png\" alt=\"reserve_hennessey-fire\" height=\"300\"/>\n</p>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}