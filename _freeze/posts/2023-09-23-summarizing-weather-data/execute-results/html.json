{
  "hash": "e0a51369b50cc5e76548fc51944d4c51",
  "result": {
    "markdown": "---\ntitle:  Scraping Weather Data 3\nauthor: RJ Cody Markelz\ndescription: --Visualizing Weather Data\ndate: 2023-09-23\ncategories: [weather, data, scraping, website, meta-data, research, journalism, data journalism, avalanche, ski touring, back country skiing]\nimage: /images/MSAC_3daySnowWind_AvyWarning.png\n---\n\n\n\n\nThis post is the third in a series teaching data journalists how to scrape website data, clean it up, and do some exploratory visualizations with it.  See the other posts in the series [Post 1](/posts/2023-09-21-scraping-weather-data-setup.html), [Post 2](/posts/2023-09-22-scraping-weather-data.html), and [Post 4](/posts/2023-10-01-avalanche-data-animation.html). \n\n### Introduction\nI started collaborating with the [Mount Shasta Avalanche Center](https://www.shastaavalanche.org/#/all) for a long form data journalism project looking at snow and avalanche condition forecasting with the backdrop of climate change. This adds an additional layer of uncertainty into any type of short-term forecast. Forecasters put out daily forecasts that integrate a lot of weather, snowfall, wind speed, direction, terrain, and previous snowfall information along with on the ground observational data collected from snow pits. [Here](https://www.shastaavalanche.org/page/how-read-advisory) is a brief summary of how to read a forecast.\n\nI thought this would be a good opportunity to show how you can collect, clean, and visualize your own data-sets for data journalism projects. I will be scraping the Avalanche Center's public website to assemble an aggregated data-set of my own to ask my own questions. This is a series of posts on the topic using open-source data tools. \n\nThis post takes the scraped data from previous post and starts to make visual summaries of the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(zoo)\n```\n:::\n\n\nINFILE DATA HERE \n\n::: {.cell}\n\n```{.r .cell-code}\nload(file = \"~/DATA/data/Avalanche-Data-2017-2023.RData\")\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"weather3\"\n```\n:::\n:::\n\nThe \n\n::: {.cell}\n\n```{.r .cell-code}\nunique(weather3$`Fx Rating `)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"LOW\"  \"MOD\"  \"CON\"  \"HIGH\" \"NONE\" \"EXT\" \n```\n:::\n\n```{.r .cell-code}\nweather3$danger <- as.factor(weather3$`Fx Rating `)\n\n# Define the desired order for factor levels\ndesired_order <- c(\"LOW\", \"MOD\", \"CON\", \"HIGH\", \"EXT\")\n\n# Reorder the factor variable according to the desired order\nweather3$danger <- factor(weather3$danger, levels = desired_order)\n\n\n# Quick few plots to make sure everything looks reasonable\nweather_plot <- ggplot(weather3, aes(x=date, y=`Fx Snow (in) Min`)) +\n  geom_point()\nweather_plot\n```\n\n::: {.cell-output-display}\n![](2023-09-23-summarizing-weather-data_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"~/DATA/images/weather-scraping-plot.png\")\n\ncustom_colors <- c(\"LOW\" = \"green\", \"MOD\" = \"yellow\", \"CON\" = \"orange\", \"HIGH\" = \"red\", \"EXT\" = \"black\")\n\nweather_plot2 <- ggplot(weather3, aes(x=date, y=`Fx Wind (mi/hr) Max`, color = danger)) +\n  geom_point(shape = 5, size = 4) + scale_color_manual(values = custom_colors)\nweather_plot2\n```\n\n::: {.cell-output-display}\n![](2023-09-23-summarizing-weather-data_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"~/DATA/images/weather-scraping-plot-danger.png\")\n```\n:::\n\n\n\n\n\nNow we are going to use the zoo package to calculate rolling averages of snow fall and wind - two important interacting components for creating avalanche conditions. Experiment a bit with the window width if you like. I think that a three day average for the amount of snow fall over the past 24 hours is a good metric. \n\n::: {.cell}\n\n```{.r .cell-code}\n# # make sure library zoo is loaded\nweather3$snow_avg_3 <- rollapply(weather3$`Ob Snow (in) HN24`, width = 3,\n                                 FUN = mean, align = \"left\", fill = NA)\nweather3$snow_avg_5 <- rollapply(weather3$`Ob Snow (in) HN24`, width = 5,\n                                 FUN = mean, align = \"left\", fill = NA)\nweather3$wind_avg_5 <- rollapply(weather3$`Ob Wind (mi/hr) Avg`, width = 5,\n                                 FUN = mean, align = \"left\", fill = NA)\nweather3$wind_avg_3 <- rollapply(weather3$`Ob Wind (mi/hr) Avg`, width = 3,\n                                 FUN = mean, align = \"left\", fill = NA)\n\n\nweather_plot3 <- ggplot() +\n                 geom_point(data = weather3,\n                            aes(x = date, y=snow_avg_3,\n                                color = danger), shape = 18, size = 4) +\n                 scale_color_manual(values = custom_colors) +\n                 scale_y_continuous(name = \"Snow Avg 3 days\",) +\n                 labs(title = \"\",\n                      color = \"Avalanche Danger\")\nweather_plot3\n```\n\n::: {.cell-output-display}\n![](2023-09-23-summarizing-weather-data_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"~/DATA/images/MSAC_3daySnow_AvyWarning.png\", height = 10, width = 8)\n\nweather_plot4 <- ggplot() +\n                 geom_point(data = weather3,\n                            aes(x = date, y=wind_avg_3),\n                            color = \"azure4\") +\n                 geom_point(data = weather3,\n                            aes(x = date, y=snow_avg_3,\n                            color = danger), shape = 18, size = 4) +\n                 scale_color_manual(values = custom_colors) +\n                 scale_y_continuous(name = \"3 day Wind (mi/hr) Avg\",\n                           sec.axis = sec_axis(~.,\n                           name = \"Rolling Average Snow 3 day Accumulation\")) +\n                 labs(title = \"\",\n                      color = \"Avalanche Danger\")\nweather_plot4\n```\n\n::: {.cell-output-display}\n![](2023-09-23-summarizing-weather-data_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"~/DATA/images/MSAC_3daySnowWind_AvyWarning.png\", height = 10, width = 8)\n```\n:::\n\n\n\nIn California the snow season starts when the rain historically starts to fall consistently in October and goes through the end of April of the following year. Let's partition up this entire data set to reflect the winter seasons.\n\n::: {.cell}\n\n```{.r .cell-code}\nweather3 <- weather3 %>%\n  mutate(season = case_when(\n    between(date, as.Date(\"2017-10-01\"), as.Date(\"2018-04-30\")) ~ \"Season17-18\",\n    between(date, as.Date(\"2018-10-01\"), as.Date(\"2019-04-30\")) ~ \"Season18-19\",\n    between(date, as.Date(\"2019-10-01\"), as.Date(\"2020-04-30\")) ~ \"Season19-20\",\n    between(date, as.Date(\"2020-10-01\"), as.Date(\"2021-04-30\")) ~ \"Season20-21\",\n    between(date, as.Date(\"2021-10-01\"), as.Date(\"2022-04-30\")) ~ \"Season21-22\",\n    between(date, as.Date(\"2022-10-01\"), as.Date(\"2023-04-30\")) ~ \"Season22-23\"\n  ))\n\n# Make the seasons span the years\nweather3 <- weather3 %>%\n  mutate(\n    water_year = ifelse(month(date) %in% 1:9, year(date), year(date) + 1),\n    day_of_water_year = as.integer(difftime(date, as.Date(paste0(year(date), \"-10-01\")), units = \"days\")) + 1\n  )\n\nweather3$day_of_water_year[weather3$day_of_water_year <= 0] <- weather3$day_of_water_year[weather3$day_of_water_year <= 0] + 365 + as.integer(leap_year(weather3$date[weather3$day_of_water_year <= 0]))\n\n\nweather3$season <- as.factor(weather3$season)\nfiltered_data <- weather3 %>% filter(day_of_water_year < 205 & day_of_water_year > 50)\n```\n:::\n\n\nPlot the new filtered dataset.\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_plot4 <- ggplot(filtered_data, aes(x = day_of_water_year, y = snow_avg_3, color = danger)) +\n  geom_point(shape = 18, size = 5) +\n  facet_wrap(~season, ncol = 1) +\n  scale_color_manual(values = custom_colors) +\n  scale_y_continuous(name = \"Rolling Snow Average (3 day)\") +\n  labs(title = \"\", color = \"Avalanche Danger\")\nweather_plot4\n```\n\n::: {.cell-output-display}\n![](2023-09-23-summarizing-weather-data_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\nSave the data for the next post.\n\n::: {.cell}\n\n```{.r .cell-code}\nsave(filtered_data, file = \"~/DATA/data/Avalanche-Data-2017-2023-filtered.RData\")\n```\n:::\n\n\n See the other posts in the series [Post 1](/posts/2023-09-21-scraping-weather-data-setup.html), [Post 2](/posts/2023-09-22-scraping-weather-data.html) and [Post 4](/posts/2023-10-01-avalanche-data-animation.html).",
    "supporting": [
      "2023-09-23-summarizing-weather-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}