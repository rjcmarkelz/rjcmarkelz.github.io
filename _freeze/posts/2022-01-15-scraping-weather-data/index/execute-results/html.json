{
  "hash": "3bbfd77f1e6d7ccfe1543367d8dc08a6",
  "result": {
    "markdown": "---\ntitle: Scraping Weather Data\nauthor: RJ Cody Markelz\ndescription: --Avalanche Website Data Scraping\ndate: 2022-01-15\ncategories: [weather, data, scraping, website, meta-data, research]\nimage: /images/weather-scraping-plot.png\n---\n\n\n\n\nA quick post showing how to extract data from a website and make a few plots. I chose the Mount Shasta Avalanche Center data because I monitor this everyday throughout the season to see how the avalanche forecast changes and how the snowpack is developing.\n\n# R vest\nThere is a great website scraping package that is part of the tidyverse called Rvest. Check out the [Documentation](https://rvest.tidyverse.org/).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(tidyverse)\nlibrary(lubridate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhtml <- read_html(\"https://www.shastaavalanche.org/page/seasonal-weather-history-mount-shasta\")\n\n# right click on the page to see the table\nhtml %>%\n    html_element(\".msac-wx-history-table\") %>%\n    html_table()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13 × 2\n   `Weather History Summary from Oct 1, 2022 to Mar 29, 2023` Weather History …¹\n   <chr>                                                                   <dbl>\n 1 Temp Max (°F)                                                            49  \n 2 Temp Min (°F)                                                             3  \n 3 Temp Avg (°F)                                                            24  \n 4 Wind Max (mi/hr)                                                         68.5\n 5 Wind Min (mi/hr)                                                          0  \n 6 Wind Avg (mi/hr)                                                         12  \n 7 Wind Gust Max (mi/hr)                                                   110. \n 8 Total Snowfall (in)                                                     327. \n 9 Total Accumulated Precipitation (Water Equivalent) (in)                  28.4\n10 Max Snowfall in 24 Hrs (in)                                              36.2\n11 Snow Depth Max (in)                                                     212. \n12 Snow Depth Min (in)                                                      31.9\n13 Snow Depth Avg (in)                                                     124  \n# … with abbreviated variable name\n#   ¹​`Weather History Summary from Oct 1, 2022 to Mar 29, 2023`\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Right click on the page and get the xpath to a specific table\nxpath <- \"/html/body/div[2]/main/div/article/div/table[2]\"\nweather <- html_nodes(html, xpath = xpath)\nhtml_table(weather)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 131 × 21\n   Observed an…¹ Obser…² Obser…³ Obser…⁴ Obser…⁵ Obser…⁶ Obser…⁷ Obser…⁸ Obser…⁹\n   <chr>         <chr>   <chr>   <chr>   <chr>   <chr>   <chr>   <chr>   <chr>  \n 1 \"\"            Ob Tem… Ob Tem… Ob Tem… Ob Win… Ob Win… Ob Win… Ob Win… Ob Win…\n 2 \"Date\"        Min     Max     Avg     Min     Max     Avg     Gust    Dir    \n 3 \"2023 03/28\"  16.5    23.5    18      5.5     20      9.5     42.93   SSE    \n 4 \"2023 03/27\"  16.5    23.5    18      5.5     20      11.5    42.93   SSE    \n 5 \"2023 03/26\"  4       28      15.5    1       10.5    5.5     24.54   SE     \n 6 \"2023 03/25\"  6.5     22      15      5.5     33.5    16.5    67.47   NW     \n 7 \"2023 03/24\"  5       24      14.5    4.5     39      22      61.34   NW     \n 8 \"2023 03/23\"  12.5    29      19.5    8.5     39      20      67.47   WNW    \n 9 \"2023 03/22\"  19      28.5    23.5    7       11.5    10      30.66   WNW    \n10 \"2023 03/21\"  19      28.5    23.5    4.5     37      25.5    67.47   E      \n# … with 121 more rows, 12 more variables:\n#   `Observed and Forecast Weather by Day` <chr>,\n#   `Observed and Forecast Weather by Day` <chr>,\n#   `Observed and Forecast Weather by Day` <chr>,\n#   `Observed and Forecast Weather by Day` <chr>,\n#   `Observed and Forecast Weather by Day` <chr>,\n#   `Observed and Forecast Weather by Day` <chr>, …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# make a data.frame with the table\nweather2 <- as.data.frame(html_table(weather, fill=TRUE))\n\n# rename columns\nnames(weather2) <- paste(weather2[1,], weather2[2,])\nnames(weather2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \" Date\"                       \"Ob Temp (°F) Min\"           \n [3] \"Ob Temp (°F) Max\"            \"Ob Temp (°F) Avg\"           \n [5] \"Ob Wind (mi/hr) Min\"         \"Ob Wind (mi/hr) Max\"        \n [7] \"Ob Wind (mi/hr) Avg\"         \"Ob Wind (mi/hr) Gust\"       \n [9] \"Ob Wind (mi/hr) Dir\"         \"Ob Snow (in) HS\"            \n[11] \"Ob Snow (in) HN24\"           \"Ob Snow (in) SWE\"           \n[13] \"Ob Snow (in) Total Snowfall\" \"Fx Temp (°F) Min\"           \n[15] \"Fx Temp (°F) Max\"            \"Fx Wind (mi/hr) Min\"        \n[17] \"Fx Wind (mi/hr) Max\"         \"Fx Snow (in) Min\"           \n[19] \"Fx Snow (in) Max\"            \"Fx Snow (in) SWE\"           \n[21] \"Fx Rating \"                 \n```\n:::\n\n```{.r .cell-code}\nnames(weather2)[1] <- paste(\"date\")\n\n# remove rows that are now column names\nweather2 <- weather2[-c(1,2),]\n\n# take a look\nglimpse(weather2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 129\nColumns: 21\n$ date                          <chr> \"2023 03/28\", \"2023 03/27\", \"2023 03/26\"…\n$ `Ob Temp (°F) Min`            <chr> \"16.5\", \"16.5\", \"4\", \"6.5\", \"5\", \"12.5\",…\n$ `Ob Temp (°F) Max`            <chr> \"23.5\", \"23.5\", \"28\", \"22\", \"24\", \"29\", …\n$ `Ob Temp (°F) Avg`            <chr> \"18\", \"18\", \"15.5\", \"15\", \"14.5\", \"19.5\"…\n$ `Ob Wind (mi/hr) Min`         <chr> \"5.5\", \"5.5\", \"1\", \"5.5\", \"4.5\", \"8.5\", …\n$ `Ob Wind (mi/hr) Max`         <chr> \"20\", \"20\", \"10.5\", \"33.5\", \"39\", \"39\", …\n$ `Ob Wind (mi/hr) Avg`         <chr> \"9.5\", \"11.5\", \"5.5\", \"16.5\", \"22\", \"20\"…\n$ `Ob Wind (mi/hr) Gust`        <chr> \"42.93\", \"42.93\", \"24.54\", \"67.47\", \"61.…\n$ `Ob Wind (mi/hr) Dir`         <chr> \"SSE\", \"SSE\", \"SE\", \"NW\", \"NW\", \"WNW\", \"…\n$ `Ob Snow (in) HS`             <chr> \"212.3\", \"211.1\", \"188.6\", \"190.9\", \"190…\n$ `Ob Snow (in) HN24`           <chr> \"9.5\", \"18.5\", \"0\", \"0.1\", \"0\", \"0\", \"0\"…\n$ `Ob Snow (in) SWE`            <chr> \"0\", \"0\", \"0.01\", \"0\", \"0.05\", \"0.16\", \"…\n$ `Ob Snow (in) Total Snowfall` <chr> \"310.8\", \"301.3\", \"282.8\", \"282.8\", \"282…\n$ `Fx Temp (°F) Min`            <chr> \"17\", \"18\", \"12\", \"11\", \"11\", \"14\", \"23\"…\n$ `Fx Temp (°F) Max`            <chr> \"30\", \"27\", \"27\", \"21\", \"22\", \"26\", \"33\"…\n$ `Fx Wind (mi/hr) Min`         <chr> \"15\", \"30\", \"25\", \"25\", \"30\", \"25\", \"10\"…\n$ `Fx Wind (mi/hr) Max`         <chr> \"25\", \"40\", \"35\", \"35\", \"40\", \"45\", \"20\"…\n$ `Fx Snow (in) Min`            <chr> \"5\", \"12\", \"0\", \"0\", \"2\", \"3\", \"2\", \"0\",…\n$ `Fx Snow (in) Max`            <chr> \"9.5\", \"18.5\", \"1.5\", \"1.5\", \"5\", \"7\", \"…\n$ `Fx Snow (in) SWE`            <chr> \"0.42\", \"1.01\", \"0.01\", \"0.03\", \"0.05\", …\n$ `Fx Rating `                  <chr> \"CON\", \"MOD\", \"MOD\", \"MOD\", \"LOW\", \"LOW\"…\n```\n:::\n\n```{.r .cell-code}\n# columns that are numeric should be converted back to such. They were coerced into character vectors because of the first two rows were characters.\nweather2 <- weather2 %>%\nmutate_at(c(2:8), as.numeric)\n\nweather2 <- weather2 %>%\nmutate_at(c(10:20), as.numeric)\n\n# coerce date column\nweather2 <- weather2 %>%\nmutate_at(1, as_date)\n\n# take a quick look\nhead(weather2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        date Ob Temp (°F) Min Ob Temp (°F) Max Ob Temp (°F) Avg\n3 2023-03-28             16.5             23.5             18.0\n4 2023-03-27             16.5             23.5             18.0\n5 2023-03-26              4.0             28.0             15.5\n6 2023-03-25              6.5             22.0             15.0\n7 2023-03-24              5.0             24.0             14.5\n8 2023-03-23             12.5             29.0             19.5\n  Ob Wind (mi/hr) Min Ob Wind (mi/hr) Max Ob Wind (mi/hr) Avg\n3                 5.5                20.0                 9.5\n4                 5.5                20.0                11.5\n5                 1.0                10.5                 5.5\n6                 5.5                33.5                16.5\n7                 4.5                39.0                22.0\n8                 8.5                39.0                20.0\n  Ob Wind (mi/hr) Gust Ob Wind (mi/hr) Dir Ob Snow (in) HS Ob Snow (in) HN24\n3                42.93                 SSE           212.3               9.5\n4                42.93                 SSE           211.1              18.5\n5                24.54                  SE           188.6               0.0\n6                67.47                  NW           190.9               0.1\n7                61.34                  NW           190.7               0.0\n8                67.47                 WNW           192.9               0.0\n  Ob Snow (in) SWE Ob Snow (in) Total Snowfall Fx Temp (°F) Min\n3             0.00                       310.8               17\n4             0.00                       301.3               18\n5             0.01                       282.8               12\n6             0.00                       282.8               11\n7             0.05                       282.7               11\n8             0.16                       282.7               14\n  Fx Temp (°F) Max Fx Wind (mi/hr) Min Fx Wind (mi/hr) Max Fx Snow (in) Min\n3               30                  15                  25                5\n4               27                  30                  40               12\n5               27                  25                  35                0\n6               21                  25                  35                0\n7               22                  30                  40                2\n8               26                  25                  45                3\n  Fx Snow (in) Max Fx Snow (in) SWE Fx Rating \n3              9.5             0.42        CON\n4             18.5             1.01        MOD\n5              1.5             0.01        MOD\n6              1.5             0.03        MOD\n7              5.0             0.05        LOW\n8              7.0             0.06        LOW\n```\n:::\n\n```{.r .cell-code}\nglimpse(weather2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 129\nColumns: 21\n$ date                          <date> 2023-03-28, 2023-03-27, 2023-03-26, 202…\n$ `Ob Temp (°F) Min`            <dbl> 16.5, 16.5, 4.0, 6.5, 5.0, 12.5, 19.0, 1…\n$ `Ob Temp (°F) Max`            <dbl> 23.5, 23.5, 28.0, 22.0, 24.0, 29.0, 28.5…\n$ `Ob Temp (°F) Avg`            <dbl> 18.0, 18.0, 15.5, 15.0, 14.5, 19.5, 23.5…\n$ `Ob Wind (mi/hr) Min`         <dbl> 5.5, 5.5, 1.0, 5.5, 4.5, 8.5, 7.0, 4.5, …\n$ `Ob Wind (mi/hr) Max`         <dbl> 20.0, 20.0, 10.5, 33.5, 39.0, 39.0, 11.5…\n$ `Ob Wind (mi/hr) Avg`         <dbl> 9.5, 11.5, 5.5, 16.5, 22.0, 20.0, 10.0, …\n$ `Ob Wind (mi/hr) Gust`        <dbl> 42.93, 42.93, 24.54, 67.47, 61.34, 67.47…\n$ `Ob Wind (mi/hr) Dir`         <chr> \"SSE\", \"SSE\", \"SE\", \"NW\", \"NW\", \"WNW\", \"…\n$ `Ob Snow (in) HS`             <dbl> 212.3, 211.1, 188.6, 190.9, 190.7, 192.9…\n$ `Ob Snow (in) HN24`           <dbl> 9.5, 18.5, 0.0, 0.1, 0.0, 0.0, 0.0, 0.0,…\n$ `Ob Snow (in) SWE`            <dbl> 0.00, 0.00, 0.01, 0.00, 0.05, 0.16, 0.00…\n$ `Ob Snow (in) Total Snowfall` <dbl> 310.8, 301.3, 282.8, 282.8, 282.7, 282.7…\n$ `Fx Temp (°F) Min`            <dbl> 17, 18, 12, 11, 11, 14, 23, 22, 18, 23, …\n$ `Fx Temp (°F) Max`            <dbl> 30, 27, 27, 21, 22, 26, 33, 36, 30, 32, …\n$ `Fx Wind (mi/hr) Min`         <dbl> 15, 30, 25, 25, 30, 25, 10, 20, 25, 45, …\n$ `Fx Wind (mi/hr) Max`         <dbl> 25, 40, 35, 35, 40, 45, 20, 30, 35, 55, …\n$ `Fx Snow (in) Min`            <dbl> 5, 12, 0, 0, 2, 3, 2, 0, 0, 7, 3, 0, 0, …\n$ `Fx Snow (in) Max`            <dbl> 9.5, 18.5, 1.5, 1.5, 5.0, 7.0, 4.0, 3.0,…\n$ `Fx Snow (in) SWE`            <dbl> 0.42, 1.01, 0.01, 0.03, 0.05, 0.06, 0.25…\n$ `Fx Rating `                  <chr> \"CON\", \"MOD\", \"MOD\", \"MOD\", \"LOW\", \"LOW\"…\n```\n:::\n\n```{.r .cell-code}\n# Quick few plots to make sure everything looks reasonable\nweather_plot <- ggplot(weather2, aes(x=date, y=`Fx Snow (in) Min`)) +\n  geom_point()\nweather_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nweather_plot2 <- ggplot(weather2, aes(x=date, y=`Fx Wind (mi/hr) Max`)) +\n  geom_point()\nweather_plot2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"~/DATA/images/weather-scraping-plot.png\")\n```\n:::\n\n\nUp next: Making sure the data is cleaned up after the scrape and coercion.\n\n\n<!-- # weather_plot2 <- ggplot(weather2, aes(x=date, y=`Ob Temp (°F) Avg`, color = `Fx Rating `)) +\n#   geom_point()\n# weather_plot2\n#\n# # need to fix Fx Rating column data. Inconsistent. -->\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}